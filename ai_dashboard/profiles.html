<!DOCTYPE html>
<html lang="en" class="h-full">

<head>
  <meta charset="UTF-8">
  <title>TremorSense AI — Profile Trends</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description"
    content="Longitudinal tremor biomarker trends, overtime analytics, and past session reports.">
  <link rel="stylesheet" href="./dashboard.css">
</head>

<body class="bg-[#060610] text-slate-100 font-sans h-full flex overflow-x-hidden">
  <canvas id="bgCanvas" class="fixed inset-0 w-full h-full pointer-events-none z-0 opacity-40"></canvas>

  <!-- ═══════════════════════ SIDEBAR ═══════════════════════ -->
  <aside class="fixed top-0 left-0 bottom-0 z-50 flex flex-col w-60
         bg-[rgba(6,6,20,0.92)] border-r border-white/[0.06]
         backdrop-blur-2xl px-4 py-5">
    <div class="flex items-center justify-between pb-4 mb-3 border-b border-white/[0.06]">
      <div class="flex items-center gap-3">
        <div class="w-9 h-9 rounded-xl flex items-center justify-center flex-shrink-0
                    border border-violet-500/30"
          style="background:linear-gradient(135deg,rgba(139,92,246,0.3),rgba(45,212,191,0.2))">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
            <circle cx="12" cy="12" r="9" fill="rgba(139,92,246,0.35)" stroke="#8b5cf6" stroke-width="1.5" />
            <path d="M6 13l3-3 3 3 3-3 3 3" stroke="#e5e7eb" stroke-width="1.5" stroke-linecap="round"
              stroke-linejoin="round" />
          </svg>
        </div>
        <div>
          <div
            class="font-grotesk text-base font-bold bg-gradient-to-r from-violet-400 to-teal-400 bg-clip-text text-transparent">
            Patient Profile
          </div>
          <div class="text-[10px] text-slate-500 font-medium tracking-wider uppercase mt-0.5">
            Longitudinal Trends
          </div>
        </div>
      </div>
      <a href="./index.html" class="text-[10px] font-semibold text-slate-400 px-2 py-1 rounded-lg border border-white/[0.08]
               hover:border-violet-400/60 hover:text-violet-300 transition-colors">
        Dashboard
      </a>
    </div>

    <div class="text-[9px] font-bold tracking-widest uppercase text-slate-600 px-1 mb-3">
      Profile
    </div>

    <div class="flex flex-col gap-2 mb-4">
      <div class="flex items-center gap-3 bg-white/[0.03] border border-white/[0.08] rounded-xl px-3 py-2.5">
        <div class="w-7 h-7 rounded-full bg-violet-500/20 flex items-center justify-center text-xs font-bold">
          P1
        </div>
        <div class="flex-1 min-w-0">
          <div class="text-[12px] font-semibold text-slate-100 truncate" id="profileName">
            Default Clinical Profile
          </div>
          <div class="text-[10px] text-slate-500">Local · Fake identifier</div>
        </div>
      </div>
    </div>

    <div class="h-px bg-white/[0.06] my-5"></div>

    <div class="text-[9px] font-bold tracking-widest uppercase text-slate-600 px-1 mb-3">
      Summary
    </div>
    <div class="flex flex-col gap-2 bg-white/[0.025] border border-white/[0.06] rounded-xl p-3 text-[11px] mb-4">
      <div class="flex justify-between items-center">
        <span class="text-slate-500">Sessions</span>
        <span id="profileSessionCount" class="font-mono text-xs text-slate-100">0</span>
      </div>
      <div class="flex justify-between items-center">
        <span class="text-slate-500">Mean score (all)</span>
        <span id="profileMeanScore" class="font-mono text-xs text-emerald-400">—</span>
      </div>
      <div class="flex justify-between items-center">
        <span class="text-slate-500">Trend</span>
        <span id="profileTrendLabel" class="font-mono text-xs text-slate-400">—</span>
      </div>
      <div class="flex justify-between items-center">
        <span class="text-slate-500">Avg Duration</span>
        <span id="profileAvgDuration" class="font-mono text-xs text-slate-300">—</span>
      </div>
      <div class="flex justify-between items-center">
        <span class="text-slate-500">Last Session</span>
        <span id="profileLastSession" class="font-mono text-xs text-slate-300">—</span>
      </div>
    </div>

    <div class="flex-1"></div>
    <div class="text-[10px] text-slate-600 mt-4">
      Data is stored locally in a SQLite file (`profiles.db`) on this machine.
    </div>
  </aside>

  <!-- ═══════════════════════ MAIN CONTENT ═══════════════════════ -->
  <main class="ml-60 flex-1 flex flex-col min-h-screen relative z-10">
    <header class="sticky top-0 z-40 flex items-center justify-between px-7 py-4
                   border-b border-white/[0.06] bg-[rgba(6,6,16,0.75)] backdrop-blur-xl">
      <div>
        <h1 class="font-grotesk text-xl font-bold tracking-tight">Longitudinal Tremor Profile</h1>
        <p class="text-xs text-slate-500 mt-0.5">
          Aggregated biomarkers from previous AI-analyzed sessions. Click any session to view its full report.
        </p>
      </div>
      <div class="flex items-center gap-3 text-[11px] text-slate-500">
        <span class="w-1.5 h-1.5 rounded-full bg-emerald-400 shadow-[0_0_8px_rgba(52,211,153,0.7)]"></span>
        Local-only SQL storage
      </div>
    </header>

    <!-- ──── Statistics Overview Cards ──── -->
    <div class="px-7 pt-4 pb-1">
      <div class="text-[9px] font-bold tracking-widest uppercase text-slate-600 mb-2">Statistics Overview</div>
      <div class="gap-2.5" id="statsGrid" style="display:grid;grid-template-columns:repeat(5,minmax(0,1fr))">
        <!-- Best Score -->
        <div class="vital-card group">
          <div class="icon-wrap teal">
            <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
              <polyline points="23 6 13.5 15.5 8.5 10.5 1 18" />
              <polyline points="17 6 23 6 23 12" />
            </svg>
          </div>
          <div>
            <div class="text-[10px] text-slate-500 font-semibold uppercase tracking-wider">Best Score</div>
            <div class="font-mono text-lg font-bold text-teal-400" id="statBestScore">—</div>
          </div>
        </div>
        <!-- Worst Score -->
        <div class="vital-card group">
          <div class="icon-wrap rose">
            <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
              <polyline points="23 18 13.5 8.5 8.5 13.5 1 6" />
              <polyline points="17 18 23 18 23 12" />
            </svg>
          </div>
          <div>
            <div class="text-[10px] text-slate-500 font-semibold uppercase tracking-wider">Worst Score</div>
            <div class="font-mono text-lg font-bold text-rose-400" id="statWorstScore">—</div>
          </div>
        </div>
        <!-- Avg RMS -->
        <div class="vital-card group">
          <div class="icon-wrap violet">
            <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
              <path d="M2 12h4l3-9 4 18 3-9h4" />
            </svg>
          </div>
          <div>
            <div class="text-[10px] text-slate-500 font-semibold uppercase tracking-wider">Avg RMS</div>
            <div class="font-mono text-lg font-bold text-violet-400" id="statAvgRms">—</div>
          </div>
        </div>
        <!-- Avg Stability -->
        <div class="vital-card group">
          <div class="icon-wrap emerald">
            <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
              <circle cx="12" cy="12" r="10" />
              <path d="M12 6v6l4 2" />
            </svg>
          </div>
          <div>
            <div class="text-[10px] text-slate-500 font-semibold uppercase tracking-wider">Avg Stability</div>
            <div class="font-mono text-lg font-bold text-emerald-400" id="statAvgStability">—</div>
          </div>
        </div>
        <!-- Total Recording Time -->
        <div class="vital-card group">
          <div class="icon-wrap amber">
            <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
              <rect x="3" y="3" width="18" height="18" rx="2" />
              <path d="M3 9h18" />
              <path d="M9 21V9" />
            </svg>
          </div>
          <div>
            <div class="text-[10px] text-slate-500 font-semibold uppercase tracking-wider">Total Time</div>
            <div class="font-mono text-lg font-bold text-amber-400" id="statTotalTime">—</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ──── Metric Selector + Overtime Charts ──── -->
    <div class="px-7 pt-8 pb-4">
      <div class="flex items-center justify-between">
        <div class="text-[9px] font-bold tracking-widest uppercase text-slate-600">Overtime Trends</div>
        <div class="flex gap-1" id="metricTabs">
          <button class="test-result-tab active" data-metric="mean_score">Severity</button>
          <button class="test-result-tab" data-metric="rms">RMS</button>
          <button class="test-result-tab" data-metric="stability">Stability</button>
          <button class="test-result-tab" data-metric="entropy">Entropy</button>
          <button class="test-result-tab" data-metric="cv">CoV</button>
          <button class="test-result-tab" data-metric="band">Dom. Band</button>
        </div>
      </div>
    </div>

    <div class="grid gap-6 px-7 pb-5 flex-1" style="grid-template-columns: minmax(0, 2fr) minmax(0, 1.4fr)">
      <!-- Left: Charts -->
      <section class="flex flex-col gap-4">
        <!-- Primary overtime chart -->
        <div class="panel-card fade-item">
          <div class="panel-header">
            <div class="panel-label">
              <div class="panel-icon teal bg-teal-400/10 border-teal-400/20 text-teal-400">
                <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                  <polyline points="3 17 9 11 13 15 21 7" />
                  <polyline points="21 11 21 7 17 7" />
                </svg>
              </div>
              <span class="panel-label-text" id="overtimeChartLabel">Session Severity Trend</span>
            </div>
            <span id="trendBadgeProfile"
              class="font-mono text-[10px] px-2 py-0.5 rounded bg-white/[0.04] text-slate-500">—</span>
          </div>
          <div class="h-64">
            <canvas id="profileTrendChart" class="w-full h-full"></canvas>
          </div>
        </div>

        <!-- Intensity Distribution (stacked area) -->
        <div class="panel-card fade-item">
          <div class="panel-header">
            <div class="panel-label">
              <div class="panel-icon violet bg-violet-400/10 border-violet-400/20 text-violet-400">
                <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                  <rect x="3" y="3" width="18" height="18" rx="2" />
                  <path d="M3 15h18" />
                  <path d="M3 9h18" />
                </svg>
              </div>
              <span class="panel-label-text">Intensity Distribution Over Time</span>
            </div>
          </div>
          <div class="h-52">
            <canvas id="profileDistChart" class="w-full h-full"></canvas>
          </div>
        </div>
      </section>

      <!-- Right: Session list + Session detail -->
      <section class="flex flex-col gap-4 relative">
        <!-- Session Dropdown Selector -->
        <div class="relative z-20">
          <button id="sessionDropdownBtn"
            class="flex items-center justify-between w-full px-4 py-3 rounded-xl border border-white/[0.08] bg-white/[0.03] hover:bg-white/[0.05] transition-colors text-left"
            aria-haspopup="listbox" aria-expanded="false">
            <div>
              <div class="text-[10px] font-bold tracking-widest uppercase text-slate-500 mb-0.5" id="sessionCountLabel">
                0 SESSIONS</div>
              <div class="text-[13px] font-semibold text-slate-200" id="selectedSessionLabel">Select a past session...
              </div>
            </div>
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
              stroke-linecap="round" stroke-linejoin="round" class="text-slate-400 transition-transform duration-200"
              id="dropdownIcon">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </button>

          <!-- Dropdown Menu -->
          <div id="sessionDropdownMenu"
            class="absolute top-full left-0 right-0 mt-2 bg-[rgba(15,15,25,0.95)] backdrop-blur-xl border border-white/[0.08] rounded-xl shadow-2xl overflow-hidden transform transition-all duration-200 origin-top z-50"
            style="opacity: 0; pointer-events: none; transform: scale(0.95);">
            <div id="sessionListEmpty" class="text-[12px] text-slate-500 p-4 text-center">
              Run a few sessions on the main dashboard and generate AI reports — they will appear here automatically.
            </div>

            <div class="max-h-[320px] overflow-y-auto custom-scroll" id="sessionList" style="display:none">
              <table class="w-full text-[11px]">
                <thead class="text-slate-500 border-b border-white/[0.06] sticky top-0 bg-[rgba(15,15,25,0.98)] z-10">
                  <tr>
                    <th class="text-left font-semibold py-2.5 pl-4 pr-3">Date</th>
                    <th class="text-left font-semibold py-2.5 pr-3">Score</th>
                    <th class="text-left font-semibold py-2.5 pr-3">Band</th>
                    <th class="text-left font-semibold py-2.5 pr-4">Conf.</th>
                  </tr>
                </thead>
                <tbody id="sessionListBody"></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Session Detail Drawer (shown when a session is selected) -->
        <div class="panel-card fade-item flex-1" id="sessionDetailPanel" style="display:none">
          <div class="panel-header">
            <div class="panel-label">
              <div class="panel-icon violet bg-violet-400/10 border-violet-400/20 text-violet-400">
                <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                  <polyline points="14 2 14 8 20 8" />
                </svg>
              </div>
              <span class="panel-label-text">Session Report</span>
            </div>
            <button id="closeDetailBtn" class="text-[10px] font-semibold text-slate-400 px-2 py-1 rounded-lg border border-white/[0.08]
               hover:border-rose-400/60 hover:text-rose-300 transition-colors cursor-pointer">
              ✕ Close
            </button>
          </div>

          <!-- Session metadata strip -->
          <div class="flex flex-wrap gap-3 mb-4 text-[10px]" id="detailMeta"></div>

          <!-- Biomarker mini-cards -->
          <div class="grid grid-cols-3 gap-2 mb-4" id="detailBiomarkers"></div>

          <!-- Clinical summary (scrollable) -->
          <div class="text-[9px] font-bold tracking-widest uppercase text-slate-600 mb-1.5">Clinical Report</div>
          <div class="flex-1 overflow-y-auto custom-scroll bg-black/20 border border-white/[0.04] rounded-xl p-4"
            id="detailReport" style="min-height: 200px">
          </div>

          <!-- Advisory -->
          <div class="mt-3 text-[10px] text-amber-400/70 border-l-2 border-amber-400/30 pl-3" id="detailAdvisory"></div>
        </div>

        <!-- Placeholder for when no session is selected -->
        <div id="sessionDetailPlaceholder"
          class="panel-card fade-item flex-1 flex flex-col items-center justify-center text-center opacity-50"
          style="min-height: 400px">
          <div class="w-16 h-16 rounded-full border border-violet-400/20 flex items-center justify-center mb-4"
            style="background:linear-gradient(135deg,rgba(139,92,246,0.1),rgba(45,212,191,0.06))">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="rgba(139,92,246,0.5)"
              stroke-width="1.5">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
              <polyline points="14 2 14 8 20 8" />
            </svg>
          </div>
          <div class="text-[13px] font-semibold text-slate-300">No Session Selected</div>
          <div class="text-[11px] text-slate-500 mt-1 max-w-[220px]">Choose a past session from the dropdown above or
            click on the chart to view its detailed report.</div>
        </div>

      </section>
    </div>
  </main>

  <script type="module" src="./profiles.js"></script>
</body>

</html>